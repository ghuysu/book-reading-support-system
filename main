import RPi.GPIO as GPIO
import subprocess
import pyttsx3
from time import sleep


def capture_and_save_image(output_path):
    command = ["libcamera-still", "-o", output_path]

    try:
        subprocess.run(command, check=True)
        print(f"Save: {output_path}")
    except subprocess.CalledProcessError as e:
        print(f"Error: {e}")


def text_to_speech(text):
    engine = pyttsx3.init()
    engine.say(text)
    engine.runAndWait()


GPIO.setmode(GPIO.BCM)

# GPIO Pins for components
buttonPin = 17

GPIO.setup(buttonPin, GPIO.IN, pull_up_down=GPIO.PUD_UP)

desktop_path = "/home/pi/Desktop"
image_filename = "snapshot.jpg"
image_path = f"{desktop_path}/{image_filename}"

try:
    while True:
        if GPIO.input(buttonPin) == GPIO.LOW:  # Check if button is pressed
            print("Button pressed!")
            capture_and_save_image(image_path)
            text_to_speech("Hello, I'm here to show you that I'm fun and say hahahahahahah")

            # Reset process state
            sleep(1)  # Wait for 1 second to allow time for button release
            while GPIO.input(buttonPin) == GPIO.LOW:  # Wait until button is released
                sleep(0.1)
except KeyboardInterrupt:
    GPIO.cleanup()
